---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

const posts = await getCollection('blog', ({ data }) => {
  return data.draft !== true;
});

// Get all tags with their post counts
const tagCounts = new Map<string, number>();
posts.forEach((post) => {
  post.data.tags?.forEach((tag) => {
    tagCounts.set(tag, (tagCounts.get(tag) || 0) + 1);
  });
});

// Convert to array and sort by count (descending), then alphabetically
const sortedTags = Array.from(tagCounts.entries())
  .sort((a, b) => {
    if (b[1] !== a[1]) return b[1] - a[1]; // Sort by count descending
    return a[0].localeCompare(b[0]); // Then alphabetically
  });

// Capitalize tag for display
function displayTag(tag: string): string {
  return tag.split('-').map(word =>
    word.charAt(0).toUpperCase() + word.slice(1)
  ).join(' ');
}
---

<Layout
  title="All Tags - Francesc CatalÃ -Moll"
  description="Browse all topics and tags from my blog"
>
  <article class="py-12 px-4 sm:px-6 lg:px-8">
    <div class="max-w-7xl mx-auto">

      <!-- Page Header -->
      <header class="mb-12">
        <!-- Back to Blog -->
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-slate-600 hover:text-primary transition-colors duration-200 mb-6"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to blog
        </a>

        <h1 class="text-3xl sm:text-4xl lg:text-5xl font-serif font-bold text-slate-900 mb-4">
          All Tags
        </h1>
        <p class="text-lg text-slate-600 font-sans">
          Browse posts by topic
        </p>
      </header>

      <!-- Tags Grid -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
        {sortedTags.map(([tag, count]) => (
          <a
            href={`/blog/tag/${tag}`}
            class="group relative bg-white rounded-xl p-6 border-2 border-slate-200 hover:border-primary transition-all duration-200 hover:shadow-lg"
          >
            <div class="flex items-center justify-between">
              <div class="flex-1">
                <h2 class="text-xl font-handwritten font-medium text-slate-900 group-hover:text-primary transition-colors duration-200 mb-2">
                  {displayTag(tag)}
                </h2>
                <p class="text-sm text-slate-600">
                  {count} {count === 1 ? 'post' : 'posts'}
                </p>
              </div>
              <svg
                class="w-6 h-6 text-slate-400 group-hover:text-primary group-hover:translate-x-1 transition-all duration-200"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
              </svg>
            </div>
          </a>
        ))}
      </div>

      <!-- Footer Navigation -->
      <footer class="mt-16">
        <a
          href="/blog"
          class="inline-flex items-center gap-2 text-slate-600 hover:text-primary transition-colors duration-200"
        >
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
          </svg>
          Back to blog
        </a>
      </footer>
    </div>
  </article>
</Layout>
